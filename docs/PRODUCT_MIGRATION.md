# Product Migration Guide

This guide explains how to migrate dummy products from constants to the database and assign them to real farmers.

## Overview

The migration process:
1. Imports all dummy products from `constants/products.ts`
2. Assigns products to existing farmers in the database
3. Distributes products evenly among available farmers
4. Updates the UI to use real database data instead of dummy data

## Prerequisites

Before running the migration, ensure you have:

1. **Farmers in the database**: At least one farmer must exist in the `userProfiles` table with `role: "farmer"`
2. **Categories initialized**: Run the category initialization first
3. **Database schema updated**: Ensure the products table schema is up to date

## Migration Steps

### Option 1: Using the Admin Interface (Recommended)

1. Navigate to `/admin/migrate` in your application
2. First run "Database Migration" to ensure schema is up to date
3. Run "Initialize Categories" if categories aren't created yet
4. Click "Migrate Products" to import dummy products and assign to farmers
5. Check the products page to see real data from the database

### Option 2: Using the Script

1. Set your environment variables:
   ```bash
   export NEXT_PUBLIC_CONVEX_URL="your_convex_url"
   ```

2. Run the migration script:
   ```bash
   npx tsx scripts/migrate-products.ts
   ```

## What Gets Migrated

### Product Data Mapping

| Dummy Field | Database Field | Notes |
|-------------|----------------|-------|
| `id` | `_id` | Auto-generated by Convex |
| `name` | `name` | Product name |
| `category` | `categoryId` | Category reference |
| `price` | `price` | Product price |
| `unit` | `unit` | Unit of measurement |
| `farmer` | `farmerId` | Assigned to real farmer |
| `location` | `location` | Product location |
| `rating` | N/A | Not stored, shown as 4.8 |
| `images` | `images` | Product images |
| `quantity` | `quantity` | Available quantity |
| `harvestDate` | `harvestDate` | Harvest date |
| `featured` | `isFeatured` | Featured status |

### Additional Database Fields

- `description`: Generated from product name and farmer
- `isOrganic`: Determined from product name containing "organic"
- `status`: Set to "active"
- `createdAt`/`updatedAt`: Current timestamp
- `coordinates`: Not set (optional field)

## Farmer Assignment

Products are distributed among farmers using a round-robin approach:
- If you have 2 farmers and 10 products, each farmer gets 5 products
- If you have 3 farmers and 10 products, farmers get 4, 3, 3 products respectively

## UI Updates

The following components have been updated to use database data:

1. **ProductsPage**: Shows featured and all products from database
2. **CategoryPage**: Shows products filtered by category from database
3. **ProductDetailPage**: Shows individual product details from database
4. **FarmerCard**: Shows farmer statistics calculated from database

## Verification

After migration, verify that:

1. **Products page** (`/products`) shows real data
2. **Category pages** (`/categories/[id]`) show filtered products
3. **Product detail pages** (`/products/[id]`) work correctly
4. **Farmer dashboard** shows updated product counts
5. **Search and filtering** work with real data

## Troubleshooting

### No Farmers Found
If you get "No farmers found" error:
1. Create farmers first through the registration process
2. Ensure farmers have `role: "farmer"` in their profile
3. Verify farmers are in the `userProfiles` table

### Duplicate Products
The migration skips products that already exist (by name). If you need to re-run:
1. Delete existing products from the database
2. Run the migration again

### Missing Images
If product images don't load:
1. Check that image paths in constants are correct
2. Ensure images exist in the public directory
3. Fallback images are used for missing images

## Rollback

To rollback the migration:
1. Delete all products from the `products` table
2. The UI will show empty states until new products are added

## Next Steps

After successful migration:
1. Test the complete user flow
2. Add real farmer data and products
3. Update product images to real photos
4. Configure proper delivery calculations
5. Set up payment processing 